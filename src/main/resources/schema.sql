CREATE TABLE IF NOT EXISTS MPA (
	ID integer GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	MPA_NAME varchar(50) NOT NULL,
	CONSTRAINT mpa_pk PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS FILMS (
	ID bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	FILM_NAME varchar(50) NOT NULL,
	DESCRIPTION varchar(500) NOT NULL,
	RELEASEDATE varchar(50),
	DURATION integer,
	MPA integer,
	CONSTRAINT films_pk PRIMARY KEY (ID)
);

ALTER TABLE FILMS ADD CONSTRAINT IF NOT EXISTS films_ratings_fk FOREIGN KEY (MPA) REFERENCES mpa(ID);

CREATE TABLE IF NOT EXISTS GENRE_NAMES (
	ID integer NOT NULL,
	GENRE_NAME varchar(50) NOT NULL,
	CONSTRAINT genres_pkey PRIMARY KEY (ID)
);


CREATE TABLE IF NOT EXISTS FILMS_GENRES (
	FILM_ID bigint NOT NULL,
	GENRE_ID integer NOT NULL,
	CONSTRAINT films_genres_pk PRIMARY KEY (FILM_ID, GENRE_ID)
);

ALTER TABLE FILMS_GENRES ADD CONSTRAINT IF NOT EXISTS films_genres_films_fk FOREIGN KEY (FILM_ID) REFERENCES FILMS(ID);
ALTER TABLE FILMS_GENRES ADD CONSTRAINT IF NOT EXISTS films_genres_genre_names_fk FOREIGN KEY (GENRE_ID) REFERENCES GENRE_NAMES(ID);

CREATE TABLE IF NOT EXISTS USERS (
	ID bigint GENERATED BY DEFAULT AS IDENTITY,
	EMAIL varchar(50) NOT NULL,
	LOGIN varchar(50) NOT NULL,
	USER_NAME varchar(50),
	BIRTHDAY varchar(50),
	CONSTRAINT users_pk PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS LIKES (
	FILM_ID bigint NOT NULL,
	USER_ID bigint NOT NULL,
	CONSTRAINT likes_pk PRIMARY KEY (FILM_ID, USER_ID)
);

ALTER TABLE likes ADD CONSTRAINT  IF NOT EXISTS likes_films_fk FOREIGN KEY (film_id) REFERENCES films(id);
ALTER TABLE likes ADD CONSTRAINT IF NOT EXISTS likes_users_fk FOREIGN KEY (user_id) REFERENCES users(id);

CREATE TABLE IF NOT EXISTS FRIENDS (
	USER_ID bigint NOT NULL,
	FRIEND_ID bigint NOT NULL,
	CONSTRAINT friends_pk PRIMARY KEY (USER_ID, FRIEND_ID)
);

ALTER TABLE friends ADD CONSTRAINT IF NOT EXISTS friends_users_fk FOREIGN KEY (user_id) REFERENCES users(id);
ALTER TABLE friends ADD CONSTRAINT IF NOT EXISTS friends_users_fk_1 FOREIGN KEY (friend_id) REFERENCES users(id);